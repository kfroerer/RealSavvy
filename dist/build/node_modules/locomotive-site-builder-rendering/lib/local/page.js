'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.buildPage = undefined;

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _server = require('react-dom/server');

var _html = require('../shared/components/html');

var _api = require('./api');

var _is_blank = require('../utils/is_blank');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function buildPage(context) {
  if (context.isRendered()) return context;

  var themeHandle = context.themeHandle,
      themes = context.themes,
      dirname = context.dirname,
      externalData = context.externalData;


  return (0, _api.getSample)(themeHandle, dirname).then(function (sample) {
    var handle = (0, _is_blank.isBlank)(sample.site.theme_handle) ? themeHandle : sample.site.theme_handle;

    sample.options = Object.assign({}, { externalData: externalData }, sample.options);

    return context.render('<!DOCTYPE html>' + (0, _server.renderToString)(_react2.default.createElement(_html.HTMLComponent, {
      definitions: themes[handle],
      data: sample,
      env: 'development'
    })));
  });
}

exports.buildPage = buildPage;