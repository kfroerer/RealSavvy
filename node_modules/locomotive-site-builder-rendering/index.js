const http        = require('http');
const local       = require('./lib/local/app');
const localTests  = require('./lib/local/tests');
const production  = require('./lib/production/app');

function _startServer(env, port, dirname, themes, routes, callback) {
  var app     = env.buildApp(dirname, themes, routes);
  var server  = http.createServer(app);
  server.listen(port, callback);
}

module.exports = {

  local: {
    startServer: function(port, dirname, themes, routes, callback) {
      _startServer(local, port, dirname, themes, routes || [], callback);
    },
    runTests: function(dirname, themes) {
      localTests.run(dirname, themes);
    }
  },

  production: {
    startServer: function(port, dirname, themes, routes) {
      _startServer(production, port, dirname, themes, routes || []);
    }
  }

}
